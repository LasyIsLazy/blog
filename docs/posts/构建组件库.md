---
title: å¦‚ä½•æ„å»ºä¸€ä¸ªç»„ä»¶åº“
date: 2019-01-24
tags:
- ç»„ä»¶åº“
---
# æ„å»ºç»„ä»¶åº“

ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ .babelrc
â”œâ”€â”€ .browserslistrc
â”œâ”€â”€ .editorconfig
â”œâ”€â”€ .eslintignore
â”œâ”€â”€ .eslintrc.js
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ build
â”‚Â Â  â”œâ”€â”€ webpack.base.config.js
â”‚Â Â  â”œâ”€â”€ webpack.prod.config.js
â”‚Â Â  â”œâ”€â”€ webpack.prod.dev.config.js
â”‚Â Â  â””â”€â”€ webpack.test.config.js
â”œâ”€â”€ commitlint.config.js
â”œâ”€â”€ docs
â”‚Â Â  â”œâ”€â”€ .vuepress
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ components
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config.js
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dist
â”‚Â Â  â”‚Â Â  â””â”€â”€ enhanceApp.js
â”‚Â Â  â”œâ”€â”€ README.md
â”‚Â Â  â””â”€â”€ components
â”‚Â Â      â””â”€â”€ README.md
â”œâ”€â”€ package.json
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ components
â”‚Â Â  â””â”€â”€ index.js
â”œâ”€â”€ test
â”‚Â Â  â”œâ”€â”€ .eslintrc.js
â”‚Â Â  â””â”€â”€ unit
â”‚Â Â      â”œâ”€â”€ index.js
â”‚Â Â      â”œâ”€â”€ karma.conf.js
â”‚Â Â      â”œâ”€â”€ specs
â”‚Â Â      â””â”€â”€ util.js
â””â”€â”€ yarn.lock
```

ä½¿ç”¨åˆ°çš„ `loader`

- [css-loader](https://github.com/webpack-contrib/css-loader)ï¼šå°† `@import` å’Œ `url()` æŒ‰ç…§`import/require()`çš„æ–¹å¼è§£æ
- [style-loader](https://github.com/webpack-contrib/style-loader)ï¼šå°†é€šè¿‡ `import/require()` å¼•å…¥çš„ `css` æ’å…¥åˆ°é¡µé¢çš„ `style` æ ‡ç­¾ä¸­
- [vue-style-loader](https://github.com/vuejs/vue-style-loader)ï¼ˆ`style-loader` çš„ forkï¼‰ï¼šå°†é€šè¿‡ `import/require()` å¼•å…¥çš„ `css` æ’å…¥åˆ°é¡µé¢çš„ `style` æ ‡ç­¾ä¸­
- [less-loader](https://github.com/webpack-contrib/less-loader)ï¼šå°† `Less` ç¼–è¯‘ä¸º `CSS`
- [sass-loader](https://github.com/webpack-contrib/sass-loader)ï¼šå°† `Sass` ç¼–è¯‘ä¸º `CSS`
- [babel-loader](https://github.com/babel/babel-loader)ï¼šä½¿ç”¨ `Babel` ç¼–è¯‘ `JavaScript`
- [url-loader](https://github.com/webpack-contrib/url-loader)ï¼šå¤„ç† `import/require()`å¼•å…¥çš„æ–‡ä»¶ï¼Œå¤§äº `limit` å‚æ•°è§„å®šå¤§å°çš„æ–‡ä»¶è°ƒç”¨ `file-loader`å¤„ç†ï¼ˆå‘é€åˆ°è¾“å‡ºè·¯å¾„ï¼‰ï¼›å°äº `limit` å‚æ•°è§„å®šå¤§å°çš„æ–‡ä»¶è¿”å› `DataURL`ã€‚
- [html-loader](https://github.com/webpack-contrib/html-loader)ï¼šå¤„ç† `HTML`æ–‡ä»¶

ä½¿ç”¨åˆ°çš„ `plugins`

- [webpack.optimize.ModuleConcatenationPlugin](https://webpack.docschina.org/plugins/module-concatenation-plugin/)ï¼š`Scope Hoisting` (ä½œç”¨åŸŸæå‡:å°†æ‰€æœ‰æ¨¡å—çš„ä»£ç æ”¾åœ¨ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸé‡Œï¼‰
- [HtmlWebpackPlugin](https://webpack.docschina.org/plugins/html-webpack-plugin/)ï¼šç”Ÿæˆä¸€ä¸ª `HTML5` æ–‡ä»¶
- [FriendlyErrorsPlugin](https://github.com/geowarin/friendly-errors-webpack-plugin)ï¼šè¯†åˆ« `Webpack` çš„é”™è¯¯ï¼Œå¹¶ä»¥æ›´å‹å¥½çš„æ–¹å¼å±•ç¤ºå‡ºæ¥

## babel ç›¸å…³

### ä¾èµ–

- [babel-loader](https://www.npmjs.com/package/babel-loader)ï¼šä½¿ç”¨ `Babel` å’Œ `Webpack` ç¼–è¯‘ `JavaScript` çš„ loaderï¼Œä¾èµ–äº `@babel/core`ã€‚
- [@babel/core](https://www.npmjs.com/package/@babel/core)ï¼š`Babel` ç¼–è¯‘çš„æ ¸å¿ƒï¼Œç›¸å½“äº `Babel` çš„ APIã€‚
- [@babel/preset-env](https://www.npmjs.com/package/@babel/preset-env)ï¼šå®˜æ–¹æä¾›çš„ä¸€ä¸ª `preset`ã€‚

### é…ç½®

#### `.babelrc`

```JSON
{
  "presets": ["@babel/preset-env"]
}
```

##### `presets`

è½¬ç è§„åˆ™ï¼š

- å®˜æ–¹æä¾›çš„å‡ ä¸ªå¸¸ç”¨çš„ç¯å¢ƒï¼š
  - `@babel/preset-env`
  - `@babel/preset-flow`
  - `@babel/react`
  - `@babel/preset-typescript`
- è‡ªå·±åˆ›å»º

> æ³¨æ„ï¼š
>
> - `Babel7` å·²ç»ç§»é™¤äº† _Yearly Preset_ï¼ˆå¦‚ï¼š`babel-preset-es2015`ï¼‰ å’Œ _Stage Preset_ï¼ˆå¦‚ï¼š `babel-stage-2`ï¼‰
> - `Babel7` å°† `@babel/preset-react` æ›´åä¸º ``@babel/react`

æœ¬é¡¹ç›®é‡‡ç”¨çš„æ˜¯ `@babel/preset-env` *preset*ã€‚

`@babel/preset-env` ä¼šæ ¹æ®ä½ é…ç½®çš„ `targets`ï¼ˆä¹Ÿå°±æ˜¯æµè§ˆå™¨ç¯å¢ƒï¼‰è‡ªåŠ¨é€‰æ‹©ç¼–è¯‘ JavaScript è¦ç”¨çš„æ’ä»¶ã€‚

#### `.browserslistrc`

```
> 1%
last 2 versions
ie >= 8
```

é…ç½®é¡¹ç›®è¿è¡Œçš„ç›®æ ‡æµè§ˆå™¨ç¯å¢ƒã€‚æœ‰è®¸å¤šå·¥å…·ä¼šç”¨åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚ï¼š`autoprefixer`ã€`stylelint`â€¦â€¦

`@babel/preset-env` ä¹Ÿä¼šç”¨åˆ°è¿™ä¸ªé…ç½®ï¼Œ`@babel/preset-env` ä½¿ç”¨ [`browserslist`](https://github.com/browserslist/browserslist) çš„ `npm` åŒ…æ¥è¯»å–ç›®æ ‡ç¯å¢ƒé…ç½®ã€‚`browserslist` è¯»å–é…ç½®çš„å…¶ä¸­ä¸€ç§æ–¹å¼å°±æ˜¯ä½¿ç”¨ `.browserslistrc` æ–‡ä»¶ï¼Œæœ¬é¡¹ç›®é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚

è¯¥é¡¹ç›®é…ç½®è¯´æ˜ï¼š

```
> 1%
```

 å…¨çƒæœ‰ 1% ä»¥ä¸Šçš„äººä½¿ç”¨çš„æµè§ˆå™¨ç‰ˆæœ¬

```
last 2 versions
```

æœ€æ–°çš„ä¸¤ä¸ªç‰ˆæœ¬

```
ie >= 8
```

IE 8 åŠä»¥ä¸Š

> æç¤ºï¼šä½¿ç”¨ `npx browserslist` å¯ä»¥åˆ—å‡ºæŸ¥è¯¢æ¡ä»¶ç­›é€‰å‡ºçš„æµè§ˆå™¨

å…³äº `browserslist` çš„é…ç½®è¯´æ˜  ä»¥åŠ  æ›´å¤šè¯¦ç»†ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥åœ¨ [github](https://github.com/browserslist/browserslist) ä¸ŠæŸ¥çœ‹ã€‚

## `webpack` é…ç½®

### webpack.base.config

```JavaScript
/**
 * å…¬å…±é…ç½®
 */
const path = require('path')
const VueLoaderPlugin = require('vue-loader/lib/plugin')

const config = {

  // æ¨¡å—
  module: {

    // åŒ¹é…è¯·æ±‚çš„è§„åˆ™
    rules: [
      {
        test: /\.vue$/,
        loader: 'vue-loader',
        options: {
          sourceMap: true
        }
      },
      {
        test: /\.js$/,
        loader: 'babel-loader',
        options: {
          sourceMap: true
        },
        exclude: /node_modules/
      },
      {
        test: /\.css$/,
        loaders: [
          {
            loader: 'vue-style-loader',
            options: {
              sourceMap: true
            }
          },
          {
            loader: 'css-loader',
            options: {
              sourceMap: true
            }
          }
        ]
      },
      {
        test: /\.less$/,
        loaders: [
          {
            loader: 'vue-style-loader',
            options: {
              sourceMap: true
            }
          },
          {
            loader: 'css-loader',
            options: {
              sourceMap: true
            }
          },
          {
            loader: 'less-loader',
            options: {
              sourceMap: true
            }
          }
        ]
      },
      {
        test: /\.scss$/,
        loaders: [
          {
            loader: 'vue-style-loader',
            options: {
              sourceMap: true
            }
          },
          {
            loader: 'css-loader',
            options: {
              sourceMap: true
            }
          },
          {
            loader: 'sass-loader',
            options: {
              sourceMap: true
            }
          }
        ]
      },
      {
        test: /\.(gif|jpg|png|woff|svg|eot|ttf)\??.*$/,
        loader: 'url-loader',
        options: {
          limit: 8192
        }
      },
      {
        test: /\.html$/,
        loader: 'html-loader'
      }
    ]
  },

  // è§£æ
  resolve: {
    extensions: ['.js', '.vue'],
    alias: {
      '@': path.join(__dirname, '..', 'src')
    }
  },

  // æ’ä»¶
  plugins: [
    new VueLoaderPlugin() // Vue Loader v15 ç°åœ¨éœ€è¦é…åˆè¿™ä¸ª webpack æ’ä»¶æ‰èƒ½æ­£ç¡®ä½¿ç”¨
  ]
}

module.exports = config

```

`rules`ï¼š

- å¤„ç† `.vue` æ–‡ä»¶ä½¿ç”¨äº† `vue-loader`
- å¤„ç† `.js` æ–‡ä»¶ä½¿ç”¨äº† `babel-loader`
- å¤„ç† `.css` æ–‡ä»¶å…ˆåä½¿ç”¨äº†
  - `css-loader`
  - `vue-style-loader`
- å¤„ç† `.less` æ–‡ä»¶å…ˆåä½¿ç”¨äº†
  - `less-loader`
  - `css-loader`
  - `vue-style-loader`
- å¤„ç† `.scss` æ–‡ä»¶å…ˆåä½¿ç”¨äº†
  - `sass-loader`
  - `css-loader`
  - `vue-style-loader`
- å¤„ç†å›¾ç‰‡ã€å­—ä½“ç­‰ä½¿ç”¨äº† `url-loader`ï¼Œå¹¶è®¾ç½® `limit` ä¸º `8192`ï¼šå¤§äº `8192` Bï¼ˆByteï¼‰çš„æ–‡ä»¶è°ƒç”¨ `file-loader`å¤„ç†ï¼ˆå‘é€åˆ°è¾“å‡ºè·¯å¾„ï¼‰ï¼›å°äº `8192` B çš„æ–‡ä»¶è¿”å› `DataURL`ã€‚
- å¤„ç† `.html`æ–‡ä»¶ä½¿ç”¨äº† `html-loader`

> æ³¨æ„ï¼šVue Loader v15 ä½¿ç”¨äº†ä¸€ä¸ªä¸ä¸€æ ·çš„ç­–ç•¥æ¥æ¨å¯¼è¯­è¨€å—ä½¿ç”¨çš„ loader,ä¾‹å¦‚ï¼Œä¼šæŠŠ `<style lang="less">` å½“ä½œä¸€ä¸ªçœŸå®çš„ `.less` æ–‡ä»¶æ¥åŠ è½½ï¼Œä¹Ÿå°±æ˜¯ä¼šåŒ¹é…å¯¹ `.less` é…ç½®çš„ `rules`ï¼Œå› æ­¤æ— éœ€å†  é…ç½® `vue-loader` é…ç½®ä¸­çš„ `loaders`ï¼ˆå¹¶ä¸”è¯¥é…ç½®åœ¨ v15 ä¸­ä¹Ÿè¢«å¼ƒç”¨ï¼‰ã€‚

`resolve`ï¼š

- `extensions`ï¼šè‡ªåŠ¨è§£æç¡®å®šçš„æ‰©å±•ï¼Œèƒ½å¤Ÿä½¿ç”¨æˆ·åœ¨å¼•å…¥æ¨¡å—æ—¶ä¸å¸¦æ‰©å±•ã€‚
- `alias`ï¼šåˆ›å»º `import` æˆ– `require` çš„åˆ«åï¼Œæ¥ç¡®ä¿æ¨¡å—å¼•å…¥å˜å¾—æ›´ç®€å•ã€‚

### webpack.prod.config

```JavaScript
/**
 * æ„å»ºç”Ÿäº§ç¯å¢ƒåŒ…
 */
const path = require('path')
const merge = require('webpack-merge')
const webpackBaseConfig = require('./webpack.base.config.js')
const pkg = require('../package.json')

const name = pkg.name

const config = {

  // æ¨¡å¼
  mode: 'production',

  // å…¥å£
  entry: {
    main: './src/index.js'
  },

  // å‡ºå£
  output: {
    path: path.resolve(__dirname, '../dist/prod'),
    publicPath: '/dist/',
    filename: name + '.js',
    library: name, // æ¨¡å—åç§°
    libraryTarget: 'umd', // è¾“å‡ºæ ¼å¼
    umdNamedDefine: true // å¯¹ UMD çš„æ„å»ºè¿‡ç¨‹ä¸­çš„ AMD æ¨¡å—è¿›è¡Œå‘½å
  },

  // å¤–éƒ¨æ‰©å±•
  externals: {
    vue: {
      root: 'Vue',
      commonjs: 'vue',
      commonjs2: 'vue',
      amd: 'vue'
    },
    'element-ui': {
      root: 'ELEMENT',
      commonjs: 'element-ui',
      commonjs2: 'element-ui',
      amd: 'element-ui',
    }
  },
}
module.exports = merge(webpackBaseConfig, config)



```

åœ¨ `webpack.base.config` çš„åŸºç¡€ä¸Šå¢åŠ é…ç½®ã€‚

è¯´æ˜ï¼š

- `mode: 'production'`ï¼šæ¨¡å¼è®¾ç½®ä¸ºç”Ÿäº§ç¯å¢ƒï¼Œwebpack ä¼šè‡ªåŠ¨é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒè¿›è¡Œä¼˜åŒ–ã€‚
- `externals`ï¼šå¤–éƒ¨æ‰©å±•ã€‚ä»è¾“å‡ºçš„ bundle ä¸­æ’é™¤ä¾èµ–ã€‚é˜²æ­¢å°†æŸäº› import çš„åŒ…(package)æ‰“åŒ…åˆ° bundle ä¸­ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶(runtime)å†å»ä»å¤–éƒ¨è·å–è¿™äº›æ‰©å±•ä¾èµ–(external dependencies)ã€‚

### webpack.prod.dev.config

```JavaScript
/**
 * æ„å»ºå¼€å‘ç‰ˆç”Ÿäº§ç¯å¢ƒåŒ…
 */

const path = require('path')
const merge = require('webpack-merge')
const webpackBaseConfig = require('./webpack.base.config.js')
const pkg = require('../package.json')

const name = pkg.name

const config = {
  mode: 'development',

  // å…¥å£
  entry: {
    main: './src/index.js'
  },

  // å‡ºå£
  output: {
    path: path.resolve(__dirname, '../dist/prod.dev'),
    publicPath: '/dist/',
    filename: name + '.dev.js',
    library: 'comp', // æ¨¡å—åç§°
    libraryTarget: 'umd', // è¾“å‡ºæ ¼å¼
    umdNamedDefine: true // æ˜¯å¦æŠŠæ¨¡å—åä½œä¸ºAMDè¾“å‡ºçš„å‘½åç©ºé—´
  },

  // å¤–éƒ¨æ‰©å±•
  externals: {
    vue: {
      root: 'Vue',
      commonjs: 'vue',
      commonjs2: 'vue',
      amd: 'vue'
    }
  }
}
module.exports = merge(webpackBaseConfig, config)

```

 å¼€å‘ç‰ˆçš„ç”Ÿäº§ç¯å¢ƒåŒ…ä¸å‰é¢çš„ç”Ÿäº§ç¯å¢ƒåŒ…å”¯ä¸€çš„æ”¹å˜å°±æ˜¯å°† `mode` ä¿®æ”¹  ä¸º `development`ï¼Œé¿å… webpack å¯¹ä»£ç è¿›é¡¹å‹ç¼©ï¼Œä»¥æ–¹ä¾¿ä½¿ç”¨è€…è°ƒè¯•ã€‚

### webpack.test.config

```JavaScript
/**
 * å•å…ƒæµ‹è¯•
 */

const merge = require('webpack-merge')
const webpackBaseConfig = require('./webpack.base.config.js')
const FriendlyErrorsPlugin = require('friendly-errors-webpack-plugin')

const config = {

  // æ¨¡å¼
  mode: 'development',

  // æ’ä»¶
  plugins: [new FriendlyErrorsPlugin()]
}

module.exports = merge(webpackBaseConfig, config)

```

å•å…ƒæµ‹è¯•ä¸éœ€è¦å…¥å£å‡ºå£ï¼Œåªæ˜¯å¢åŠ äº†ä¸€ä¸ª `friendly-errors-webpack-plugin` çš„æ’ä»¶ï¼Œä½¿æ§åˆ¶å°çš„è¾“å‡ºæ›´åŠ å‹å¥½ã€‚

## å•å…ƒæµ‹è¯•

ä½¿ç”¨ `karma` + `mocha` + `chai`

`karma` é…ç½®ï¼škarma.conf.js

```JavaScript
const webpackConfig = require('../../build/webpack.test.config')

// Karma configuration
// Generated on Fri Jan 18 2019 17:21:29 GMT+0800 (GMT+08:00)

module.exports = function(config) {
  config.set({

    // base path that will be used to resolve all patterns (eg. files, exclude)
    basePath: '',

    // frameworks to use
    // available frameworks: https://npmjs.org/browse/keyword/karma-adapter
    frameworks: ['mocha', 'chai'],

    // list of files / patterns to load in the browser
    files: ['./index.js'],

    // list of files / patterns to exclude
    exclude: [],

    // preprocess matching files before serving them to the browser
    // available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor
    preprocessors: {
      './index.js': ['webpack']
    },

    webpack: webpackConfig,

    // test results reporter to use
    // possible values: 'dots', 'progress'
    // available reporters: https://npmjs.org/browse/keyword/karma-reporter
    reporters: ['spec'],

    // web server port
    port: 9876,

    // enable / disable colors in the output (reporters and logs)
    colors: true,

    // level of logging
    // possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG
    logLevel: config.LOG_INFO,

    // enable / disable watching file and executing tests whenever any file changes
    autoWatch: true,

    // start these browsers
    // available browser launchers: https://npmjs.org/browse/keyword/karma-launcher
    browsers: ['Chrome'],

    // Continuous Integration mode
    // if true, Karma captures browsers, runs the tests and exits
    singleRun: false,

    // Concurrency level
    // how many browser should be started simultaneous
    concurrency: Infinity
  })
}

```

å‚è€ƒï¼š

- [Babel å…¥é—¨æ•™ç¨‹â€”â€”é˜®ä¸€å³°](http://www.ruanyifeng.com/blog/2016/01/babel.html)
- [@babel/preset-envâ€”â€”babeljs.io](https://babeljs.io/docs/en/next/babel-preset-env.html)
- [Upgrade to Babel 7â€”â€”babeljs.io](https://babeljs.io/docs/en/v7-migration)
- [ä» v14 è¿ç§»â€”â€”vue-loader](https://vue-loader.vuejs.org/zh/migrating.html)
- [webpack](https://www.webpackjs.com)
